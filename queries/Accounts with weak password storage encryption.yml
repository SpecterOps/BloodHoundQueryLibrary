name: Accounts with weak password storage encryption
guid: 8bd6fcf2-3f3c-414c-857a-4caf28e49def
prebuilt: true
platforms: Active Directory
category: Active Directory Hygiene
description: Accounts with passwords set before Windows Server 2008 DC promotion, which therefore lack AES encryption keys. Uses the RODC group creation date to find accounts with pwdLastSet dates predating AES key generation capability.
query: |-
  MATCH (g:Group)
  WHERE g.objectid ends with "-521"
  MATCH (n:Base)
  WHERE g.domainsid = n.domainsid
  AND n.pwdlastset < g.whencreated
  RETURN n
  LIMIT 100
revision: 1
resources: https://techcommunity.microsoft.com/blog/coreinfrastructureandsecurityblog/decrypting-the-selection-of-supported-kerberos-encryption-types/1628797
acknowledgements: Martin Sohn Christensen, @martinsohndk

