name: Foreign AZ Service Principals in control of Azure tenant
guid: c82c17f1-7253-4e3a-b5d2-3647aa388f4a
prebuilt: false
platforms: Azure
category: Dangerous Privileges
description: 
query: |-
  MATCH p = (sp:AZServicePrincipal)-[]->(t:AZTenant)
  WHERE toUpper(sp.appownerorganizationid) <> toUpper(t.tenantid)
  // Ensure AZServicePrincipal has a valid appownerorganizationid
  AND sp.appownerorganizationid CONTAINS "-"
  RETURN p
  LIMIT 1000
revision: 1
resources: https://posts.specterops.io/microsoft-breach-how-can-i-see-this-in-bloodhound-33c92dca4c65
acknowledgements: Stephen Hinck

